<div class="max-w-2xl mx-auto">
  <h1 class="text-2xl font-bold text-slate-800 mb-6">Reactive Form (with FormArray)</h1>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
    <div>
      <label for="name" class="block text-sm font-medium text-slate-700 mb-1">Name</label>
      <input
        id="name"
        type="text"
        formControlName="name"
        class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
      />
      @if (form.get('name')?.invalid && form.get('name')?.touched) {
        <p class="text-red-600 text-sm mt-1">
          @if (form.get('name')?.errors?.['required']) { Name is required. }
          @if (form.get('name')?.errors?.['minlength']) { Name must be at least 2 characters. }
        </p>
      }
    </div>

    <div>
      <label for="email" class="block text-sm font-medium text-slate-700 mb-1">Email</label>
      <input
        id="email"
        type="email"
        formControlName="email"
        class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
      />
      @if (form.get('email')?.invalid && form.get('email')?.touched) {
        <p class="text-red-600 text-sm mt-1">
          @if (form.get('email')?.errors?.['required']) { Email is required. }
          @if (form.get('email')?.errors?.['email']) { Please enter a valid email. }
        </p>
      }
    </div>

    <div>
      <label for="phone" class="block text-sm font-medium text-slate-700 mb-1">Phone</label>
      <input
        id="phone"
        type="tel"
        formControlName="phone"
        class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
      />
      @if (form.get('phone')?.invalid && form.get('phone')?.touched) {
        <p class="text-red-600 text-sm mt-1">Phone is required.</p>
      }
    </div>

    <div>
      <label for="password" class="block text-sm font-medium text-slate-700 mb-1">Password</label>
      <input
        id="password"
        type="password"
        formControlName="password"
        class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
      />
      @if (form.get('password')?.invalid && form.get('password')?.touched) {
        <p class="text-red-600 text-sm mt-1">
          @if (form.get('password')?.errors?.['required']) { Password is required. }
          @if (form.get('password')?.errors?.['minLength']) { At least 8 characters. }
          @if (form.get('password')?.errors?.['requireUppercase']) { One uppercase letter. }
          @if (form.get('password')?.errors?.['requireLowercase']) { One lowercase letter. }
          @if (form.get('password')?.errors?.['requireNumber']) { One number. }
        </p>
      }
    </div>

    <div>
      <label for="confirmPassword" class="block text-sm font-medium text-slate-700 mb-1">Confirm Password</label>
      <input
        id="confirmPassword"
        type="password"
        formControlName="confirmPassword"
        class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-slate-500 focus:border-slate-500"
      />
      @if (form.get('confirmPassword')?.invalid && form.get('confirmPassword')?.touched) {
        <p class="text-red-600 text-sm mt-1">Confirm password is required.</p>
      }
      @if (form.errors?.['passwordMismatch'] && form.get('confirmPassword')?.touched) {
        <p class="text-red-600 text-sm mt-1">Passwords do not match.</p>
      }
    </div>

    <!-- Addresses FormArray -->
    <div formArrayName="addresses" class="space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold text-slate-700">Addresses</h2>
        <button
          type="button"
          class="py-1.5 px-3 rounded bg-slate-600 text-white text-sm hover:bg-slate-500"
          (click)="addAddress()"
        >
          Add address
        </button>
      </div>

      @for (addr of addresses.controls; track $index) {
        <div [formGroupName]="$index" class="p-4 border border-slate-200 rounded-lg bg-slate-50 space-y-3">
          <div class="flex justify-between items-center">
            <span class="font-medium text-slate-600">Address {{ $index + 1 }}</span>
            @if (addresses.length > 1) {
              <button
                type="button"
                class="text-red-600 text-sm hover:underline"
                (click)="removeAddress($index)"
              >
                Remove
              </button>
            }
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Street</label>
            <input
              type="text"
              formControlName="street"
              class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-slate-500"
            />
            @if (addr.get('street')?.invalid && addr.get('street')?.touched) {
              <p class="text-red-600 text-sm mt-1">Street is required.</p>
            }
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">City</label>
            <input
              type="text"
              formControlName="city"
              class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-slate-500"
            />
            @if (addr.get('city')?.invalid && addr.get('city')?.touched) {
              <p class="text-red-600 text-sm mt-1">City is required.</p>
            }
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">State</label>
            <input
              type="text"
              formControlName="state"
              class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-slate-500"
            />
            @if (addr.get('state')?.invalid && addr.get('state')?.touched) {
              <p class="text-red-600 text-sm mt-1">State is required.</p>
            }
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Pin code</label>
            <input
              type="text"
              formControlName="pinCode"
              class="w-full px-3 py-2 border rounded focus:ring-2 focus:ring-slate-500"
            />
            @if (addr.get('pinCode')?.invalid && addr.get('pinCode')?.touched) {
              <p class="text-red-600 text-sm mt-1">
                Pin code is required and must be 5â€“6 digits.
              </p>
            }
          </div>
        </div>
      }
    </div>

    <button
      type="submit"
      [disabled]="form.invalid"
      class="w-full py-2 px-4 bg-slate-800 text-white rounded hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed"
    >
      Submit
    </button>
  </form>
</div>
